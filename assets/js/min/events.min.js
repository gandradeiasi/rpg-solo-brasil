const command_controller=new CommandController;function atualizaComando(){pilha_comandos.length>1&&(txtarea_command.value=pilha_comandos[pilha_comandos_index],txtarea_command.classList.add("no-cursor"),setTimeout(()=>{txtarea_command.setSelectionRange(txtarea_command.value.length,txtarea_command.value.length),txtarea_command.classList.remove("no-cursor")},.1))}function enviaComando(){let input=txtarea_command.value;if(input)if(command_controller.reconheceComando(input))command_controller.executaComando(input);else if(/^\n/.test(input))command_controller.limpaComando();else{let input_formatado=input.replace(/\n+$/,"");command_controller.adicionaAoLog(input_formatado.replace(/\n/g,"<br>"))}}function adicionaPergunta(){let input=txtarea_command.value;input&&command_controller.adicionaAoLog(input)}function copy(text,message){txtarea_copy.value=text,txtarea_copy.select(),txtarea_copy.setSelectionRange(0,99999),document.execCommand("copy"),message&&alert(message)}btn_enviar.addEventListener("click",()=>{enviaComando()}),hamburger.addEventListener("click",()=>{mobile_menu.classList.contains("active")?mobile_menu.classList.remove("active"):mobile_menu.classList.add("active")}),copy_log.addEventListener("click",()=>copy(txtarea_log.innerText,"Log copiado para a área de transferência")),btn_rolar.addEventListener("click",()=>{adicionaPergunta(),txtarea_command.value=`/r ${dice_amount.value}d${dice_max.value}${dice_modifier.value<0?`-${-1*dice_modifier.value}`:`+${dice_modifier.value}`}`,enviaComando()}),btn_vantagem.addEventListener("click",()=>{adicionaPergunta(),txtarea_command.value=`/van ${dice_amount.value}d${dice_max.value}}`,enviaComando()}),btn_desvantagem.addEventListener("click",()=>{adicionaPergunta(),txtarea_command.value=`/des ${dice_amount.value}d${dice_max.value}}`,enviaComando()}),btn_sim_nao.addEventListener("click",()=>{adicionaPergunta(),command_controller.adicionaAoLog(`<strong>${BotaoSimNao.resultado()}<strong>`)}),btn_baralho.addEventListener("click",()=>{adicionaPergunta(),txtarea_command.value=`/carta ${dice_amount.value}d${dice_max.value}}`,enviaComando()}),modal.addEventListener("click",e=>{e.path.some(x=>!!x.classList&&x.classList.contains("body"))||Notes.fecha()}),fecha_modal.addEventListener("click",()=>Modal.fecha()),window.addEventListener("keyup",e=>{"Shift"==e.key?shift=!1:"Enter"==e.key?shift||document.activeElement!==txtarea_command?document.activeElement.id&&"add-input-title"==document.activeElement.id&&document.querySelector("#btn-adicionar").click():enviaComando():"<br>"==txtarea_log.innerHTML&&(txtarea_log.innerHTML=""),Save.save()}),window.addEventListener("keydown",e=>{if("Shift"==e.key)shift=!0;else if(document.activeElement==txtarea_command&&!txtarea_command.value||"/"==txtarea_command.value[0])switch(e.key){case"ArrowUp":pilha_comandos_index>0?(pilha_comandos_index--,atualizaComando()):atualizaComando();break;case"ArrowDown":pilha_comandos_index<pilha_comandos.length-1&&(pilha_comandos_index++,atualizaComando())}else"Escape"==e.key&&Notes.fecha()}),abre_anotacoes.addEventListener("click",()=>{anotacoes.classList.add("active")}),fecha_anotacoes.addEventListener("click",()=>{anotacoes.classList.remove("active")});